<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="ChatMapper">
	<resultMap type="ChatMember" id="chatMemberResultMap">
		<result property="chatRoomNo" column="CHAT_ROOM_NO"/>
		<result property="memNum" column="MEM_NUM"/>
		<result property="divName" column="DIV_NAME"/>
		<result property="memName" column="MEM_NAME"/>
		<result property="rankName" column="RANK_NAME"/>
		<result property="chatOutDate" column="CHAT_OUT_DATE"/>
		<result property="memStatus" column="MEM_STATUS"/>
	</resultMap>
	<insert id="insertChatRoom"><!-- 채팅방 생성 -->
		INSERT INTO CHAT_ROOM VALUES(SEQ_CHAT_ROOM.NEXTVAL, #{chatTitle}, #{chatType})
	</insert>
	<insert id="insertChatMember"><!-- 채팅방 사용자 등록 -->
		INSERT INTO CHAT_MEMBER VALUES(
			SEQ_CHAT_ROOM.CURRVAL,
			#{memberNum},
			(SELECT DIV_NAME FROM MEMBER JOIN DIVISION ON DIVISION = DIV_CODE WHERE MEMBER_NUM = #{memberNum}),
			(SELECT MEMBER_NAME FROM MEMBER WHERE MEMBER_NUM = #{memberNum}),
			(SELECT RANK_NAME FROM MEMBER JOIN RANK ON RANK = RANK_CODE WHERE MEMBER_NUM = #{memberNum}),
			NULL,
			DEFAULT
		)
	</insert>
	<select id="selectListMember" resultMap="chatMemberResultMap"><!-- 채팅방 사용자 목록 조회 -->
		SELECT * FROM CHAT_MEMBER WHERE CHAT_ROOM_NO = (SELECT MAX(CHAT_ROOM_NO) FROM CHAT_ROOM)
	</select>
	<update id="updateChatTitle"><!-- 채팅방 제목 바꾸기 -->
		UPDATE CHAT_ROOM SET CHAT_TITLE = #{chatTitle} WHERE CHAT_ROOM_NO = (SELECT MAX(CHAT_ROOM_NO) FROM CHAT_ROOM)
	</update>
</mapper>